{% extends "layout.html" %}
<script src="{{ url_for('static', filename='js/components/tentacles.js') }}"></script>
{% block body %}
<h1>Tentacle Manager</h1>
<h2 class="card-title">Registered tentacles packages</h2>

<table class="table table-striped table-sm" id="tentacles_packages_table">
  <thead>
    <tr>
        <th scope="col">Package Name</th>
        <th scope="col">Package address</th>
    </tr>
  </thead>
  <tbody>
    {% for package_path, package_name in get_tentacles_packages().items() %}
    <tr>
        <td>{{package_name}}</td>
        <td>{{package_path}}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div class="card">
  <h5 class="card-title">Additional tentacles packages registration</h5>
  <div class="card-body config-root" update-url="{{ url_for('tentacle_manager', update_type='add_package') }}">
      <div class='progress' id='register_and_install_package_progess_bar' style='display: none;'>
          <div class='progress-bar progress-bar-striped bg-danger progress-bar-animated' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width: 100%;'></div>
      </div>
      <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="Package localisation or url" aria-label="Package localisation or url" id="register_and_install_package_input">
          <div class="input-group-append">
            <button class="btn btn-outline-success config-root" type="submit" onclick="register_and_install_package()" id="register_and_install_package_button">Register and install</button>
          </div>
      </div>
  </div>
</div>
<h2>Tentacles management</h2>
<div class="card">
  <h5 class="card-title">Installed packages management</h5>
  <div class="card-body">
        <div class='progress' id='packages_action_progess_bar' style='display: none;'>
            <div class='progress-bar progress-bar-striped bg-danger progress-bar-animated' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width: 100%;'></div>
        </div>
        <div class="btn-group btn-group text-center" role="group">
            <button type="button" class="btn btn-success card-link" id="install_tentacles_packages" update-url="{{ url_for('tentacle_manager', update_type='install_packages') }}">Re-install registered tentacles packages</button>
            <button type="button" class="btn btn-primary card-link" id="update_tentacles_packages" update-url="{{ url_for('tentacle_manager', update_type='update_packages') }}">Update installed tentacles</button>
            <button type="button" class="btn btn-danger card-link" id="reset_tentacles_packages" update-url="{{ url_for('tentacle_manager', update_type='reset_packages') }}">Remove installed tentacles</button>
        </div>
  </div>
</div>
<h2>Installed tentacles</h2>
<table class="table table-striped table-sm" id="tentacles_modules_table">
  <thead>
    <tr>
        <th scope="col">#</th>
        <th scope="col">Package</th>
        <th scope="col">Tentacle Name</th>
        <th scope="col">Tentacle Type</th>
        <th scope="col">Tentacle Sub-Type</th>
        <th scope="col">Version</th>
        <th scope="col" class="text-center">Action</th>
    </tr>
  </thead>
  <tbody id="module-table" update-update-url="{{ url_for('tentacle_manager', update_type='update_modules') }}" uninstall-update-url="{{ url_for('tentacle_manager', update_type='uninstall_modules') }}">
    {% for tentacle in get_tentacles().values() %}
        <tr>
            <td><input type="checkbox" module="{{tentacle.name}}" class="tentacle-module-checkbox"></td>
            <td>{{tentacle.package_name}}</td>
            <td>{{tentacle.name}}</td>
            <td>{{tentacle.type}}</td>
            <td>{{tentacle.subtype}}</td>
            <td>{{tentacle.version}}</td>
            <td class="text-center"><a class="btn fas fa-download" onclick="update('{{tentacle.name}}')" data-toggle="tooltip" data-placement="right" title="Update tentacle"></a>
                <a class="btn fas fa-trash-alt" onclick="uninstall('{{tentacle.name}}')" data-toggle="tooltip" data-placement="right" title="Uninstall tentacle"></a></td>
        </tr>
    {% endfor %}
  </tbody>
</table>
<div class='progress' id='selected_tentacles_operation' style='display: none;'>
  <div class='progress-bar progress-bar-striped bg-danger progress-bar-animated' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width: 100%;'></div>
</div>
<div class="btn-group btn-group text-center" role="group">
    <button type="button" class="btn btn-primary card-link" id="update_selected_tentacles" update-url="{{ url_for('tentacle_manager', update_type='update_modules') }}">Update selected tentacles</button>
    <button type="button" class="btn btn-danger card-link" id="uninstall_selected_tentacles" update-url="{{ url_for('tentacle_manager', update_type='uninstall_modules') }}">Uninstall selected tentacles</button>
</div>
<script src="{{ url_for('static', filename='js/components/tentacles_configuration.js') }}"></script>
{% endblock %}